[
 {
  "_liked_by": "[]",
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 1,
  "modified": "2025-07-29 15:22:43.332159",
  "module": null,
  "name": "Edit Lead Status",
  "script": "frappe.listview_settings['Lead'] = {\n    onload(listview) {\n        listview.page.add_inner_button('Edit Lead Status', async () => {\n            const selected_leads = listview.get_checked_items();\n\n            if (selected_leads.length !== 1) {\n                frappe.msgprint(('Please select exactly one Lead'));\n                return;\n            }\n\n            const lead_name = selected_leads[0].name;\n            const lead_data = await frappe.db.get_doc(\"Lead\", lead_name);\n\n            const dialog = new frappe.ui.Dialog({\n                title: 'Edit Lead Status',\n                fields: [\n                    {\n                        fieldname: 'custom_lead_status_tag',\n                        label: 'Lead Status Tag',\n                        fieldtype: 'Select',\n                        options: [\n                            \"Required Later\",\n                            \"Not Required\",\n                            \"Send Catalogue\",\n                            \"Send Sample\",\n                            \"Send Quotation\",\n                            \"Advance Received\",\n                            \"Received Design From Party\",\n                            \"Design Approved\",\n                            \"Date Received\"\n                        ].join('\\n'),\n                        reqd: 1,\n                        default: lead_data.custom_lead_status_tag || \"\"\n                    },\n                    {\n                        fieldname: 'custom_call_again',\n                        label: 'Call Again Date',\n                        fieldtype: 'Date',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Required Later\"',\n                        default: lead_data.custom_call_again || \"\"\n                    },\n                    {\n                        fieldname: 'custom_reason',\n                        label: 'Reason',\n                        fieldtype: 'Data',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Not Required\"',\n                        default: lead_data.custom_reason || \"\"\n                    },\n                    {\n                        fieldname: 'custom_send_catalogue_email_id',\n                        label: 'Send Catalogue Email ID',\n                        fieldtype: 'Data',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Send Catalogue\"',\n                        default: lead_data.custom_send_catalogue_email_id || \"\"\n                    },\n                    {\n                        fieldname: 'custom_send_catalogue_whatsapp_no',\n                        label: 'Send Catalogue Whatsapp No',\n                        fieldtype: 'Data',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Send Catalogue\"',\n                        default: lead_data.custom_send_catalogue_whatsapp_no || \"\"\n                    },\n                    {\n                        fieldname: 'custom_sample_name',\n                        label: 'Sample Name',\n                        fieldtype: 'Data',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Send Sample\"',\n                        default: lead_data.custom_sample_name || \"\"\n                    },\n                    {\n                        fieldname: 'custom_send_sample_mobile_no',\n                        label: 'Send Sample Mobile No',\n                        fieldtype: 'Data',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Send Sample\"',\n                        default: lead_data.custom_send_sample_mobile_no || \"\"\n                    },\n                    {\n                        fieldname: 'custom_delivery_address',\n                        label: 'Delivery Address',\n                        fieldtype: 'Small Text',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Send Sample\"',\n                        default: lead_data.custom_delivery_address || \"\"\n                    },\n                    {\n                        fieldname: 'custom_date_received',\n                        label: 'Date Received',\n                        fieldtype: 'Date',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Advance Received\"',\n                        default: lead_data.custom_date_received || \"\"\n                    },\n                    {\n                        fieldname: 'custom_amount_received',\n                        label: 'Amount Received',\n                        fieldtype: 'Data',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Advance Received\"',\n                        default: lead_data.custom_amount_received || \"\"\n                    },\n                    {\n                        fieldname: 'custom_quotation_table',\n                        label: 'Quotation Table',\n                        fieldtype: 'Table',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Send Quotation\"',\n                        options: 'Custom Send Quotation Table Fields',\n                        fields: [\n                            {\n                                fieldtype: 'Link',\n                                label: 'Item',\n                                fieldname: 'custom_item',\n                                options: 'Item',\n                                reqd: 1,\n                                in_list_view: 1\n                            },\n                            {\n                                fieldtype: 'Data',\n                                label: 'Price',\n                                fieldname: 'custom_price',\n                                reqd: 1,\n                                in_list_view: 1\n                            },\n                            {\n                                fieldtype: 'Data',\n                                label: 'Quantity',\n                                fieldname: 'custom_quantity',\n                                reqd: 1,\n                                in_list_view: 1\n                            }\n                        ]\n                    },\n                    {\n                        fieldname: 'custom_upload_file',\n                        label: 'Upload File',\n                        fieldtype: 'Attach',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Received Design From Party\"',\n                        default: lead_data.custom_upload_file || \"\"\n                    },\n                    {\n                        fieldname: 'custom_send_file_to_mobile_no',\n                        label: 'Send File To Mobile No',\n                        fieldtype: 'Data',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Received Design From Party\"',\n                        default: lead_data.custom_send_file_to_mobile_no || \"\"\n                    },\n                    {\n                        fieldname: 'custom_send_file_to_email',\n                        label: 'Send File To Email',\n                        fieldtype: 'Data',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Received Design From Party\"',\n                        default: lead_data.custom_send_file_to_email || \"\"\n                    },\n                    {\n                        fieldname: 'custom_upload_final_photo_',\n                        label: 'Upload Final Photo',\n                        fieldtype: 'Attach',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Design Approved\"',\n                        default: lead_data.custom_upload_final_photo_ || \"\"\n                    },\n                    {\n                        fieldname: 'custom_send_final_file_to_mobile_no',\n                        label: 'Send Final File To Mobile No',\n                        fieldtype: 'Data',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Design Approved\"',\n                        default: lead_data.custom_send_final_file_to_mobile_no || \"\"\n                    },\n                    {\n                        fieldname: 'custom_receive_date',\n                        label: 'Receive Date',\n                        fieldtype: 'Date',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Date Received\"',\n                        default: lead_data.custom_receive_date || \"\"\n                    },\n                    {\n                        fieldname: 'custom_receive_photo',\n                        label: 'Receive Photo',\n                        fieldtype: 'Attach',\n                        depends_on: 'eval:doc.custom_lead_status_tag === \"Date Received\"',\n                        default: lead_data.custom_receive_photo || \"\"\n                    }\n                ],\n                primary_action_label: 'Update',\n                primary_action: async function (values) {\n                    await frappe.call({\n                        method: 'frappe.client.set_value',\n                        args: {\n                            doctype: 'Lead',\n                            name: lead_name,\n                            fieldname: {\n                                custom_lead_status_tag: values.custom_lead_status_tag,\n                                custom_call_again: values.custom_call_again,\n                                custom_reason: values.custom_reason,\n                                custom_send_catalogue_email_id: values.custom_send_catalogue_email_id,\n                                custom_send_catalogue_whatsapp_no: values.custom_send_catalogue_whatsapp_no,\n                                custom_sample_name: values.custom_sample_name,\n                                custom_send_sample_mobile_no: values.custom_send_sample_mobile_no,\n                                custom_delivery_address: values.custom_delivery_address,\n                                custom_date_received: values.custom_date_received,\n                                custom_amount_received: values.custom_amount_received,\n                                custom_upload_file: values.custom_upload_file,\n                                custom_send_file_to_mobile_no: values.custom_send_file_to_mobile_no,\n                                custom_send_file_to_email: values.custom_send_file_to_email,\n                                custom_upload_final_photo_: values.custom_upload_final_photo_,\n                                custom_send_final_file_to_mobile_no: values.custom_send_final_file_to_mobile_no,\n                                custom_receive_date: values.custom_receive_date,\n                                custom_receive_photo: values.custom_receive_photo\n                            }\n                        }\n                    });\n\n                    if (values.custom_lead_status_tag === \"Send Quotation\") {\n                        await frappe.call({\n                            method: \"frappe.client.set_value\",\n                            args: {\n                                doctype: \"Lead\",\n                                name: lead_name,\n                                fieldname: { custom_quotation_table: [] }\n                            }\n                        });\n\n                        if (Array.isArray(values.custom_quotation_table)) {\n                            for (const row of values.custom_quotation_table) {\n                                await frappe.call({\n                                    method: \"frappe.client.insert\",\n                                    args: {\n                                        doc: {\n                                            doctype: \"Custom Send Quotation Table Fields\",\n                                            parent: lead_name,\n                                            parenttype: \"Lead\",\n                                            parentfield: \"custom_quotation_table\",\n                                            custom_item: row.custom_item,\n                                            custom_price: row.custom_price,\n                                            custom_quantity: row.custom_quantity\n                                        }\n                                    }\n                                });\n                            }\n                        }\n                    }\n\n                    frappe.msgprint('Lead updated successfully');\n                    dialog.hide();\n                    listview.refresh();\n                }\n            });\n\n            dialog.fields_dict.custom_lead_status_tag.df.onchange = () => {\n                dialog.refresh();\n            };\n\n            dialog.show();\n            dialog.fields_dict.custom_lead_status_tag.df.onchange();\n            dialog.refresh();\n\n            if (lead_data.custom_lead_status_tag === \"Send Quotation\") {\n                const rows = await frappe.db.get_list('Custom Send Quotation Table Fields', {\n                    filters: {\n                        parent: lead_name,\n                        parenttype: 'Lead',\n                        parentfield: 'custom_quotation_table'\n                    },\n                    fields: ['custom_item', 'custom_price', 'custom_quantity']\n                });\n\n                if (Array.isArray(rows)) {\n                    dialog.fields_dict.custom_quotation_table.df.data = rows;\n                    dialog.fields_dict.custom_quotation_table.grid.df.data = rows;\n                    dialog.fields_dict.custom_quotation_table.grid.refresh();\n                }\n            }\n        });\n    }\n};",
  "view": "List"
 }
]